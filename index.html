<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ƒê·∫øm ng∆∞·ª£c T·∫øt</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#0f1724;--card:#0b1220;--accent:#f59e0b;--muted:#9aa4b2;
  color-scheme:dark;
}
body{
  margin:0;font-family:Inter,system-ui;
  background:linear-gradient(180deg,#071029,#091426);
  color:#e6eef8;min-height:100vh;
  display:flex;justify-content:center;align-items:center;
  padding:24px;
}
.wrap{
  max-width:960px;width:100%;
  display:grid;grid-template-columns:1fr 1fr;gap:18px;
}
.card{
  background:rgba(255,255,255,.03);
  border:1px solid rgba(255,255,255,.06);
  border-radius:12px;padding:20px;
}
h1{font-size:18px;margin:0 0 8px}
.big{font-size:36px;font-weight:700;color:var(--accent)}
.small{font-size:13px;color:var(--muted)}
.units{display:flex;gap:8px;margin-top:12px}
.unit{
  flex:1;background:rgba(255,255,255,.04);
  border-radius:8px;padding:10px;text-align:center
}
.unit .n{font-size:20px;font-weight:700}
.controls{
  grid-column:1/-1;display:flex;
  flex-direction:column;gap:12px
}
.input-row{display:flex;gap:8px;flex-wrap:wrap}
input{
  padding:8px;border-radius:8px;
  border:1px solid rgba(255,255,255,.1);
  background:transparent;color:#fff
}
button{
  padding:8px 14px;border-radius:8px;
  border:none;background:var(--accent);
  font-weight:700;cursor:pointer
}
footer{grid-column:1/-1;text-align:center;color:var(--muted)}
.toast{
  position:fixed;bottom:20px;left:50%;
  transform:translateX(-50%);
  background:#000;padding:10px 16px;
  border-radius:10px;opacity:0;
  transition:.3s;pointer-events:none
}
.toast.show{opacity:1}
@media(max-width:820px){.wrap{grid-template-columns:1fr}}
#fireworks {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 10000;
}
#countdown {
  position: fixed;
  inset: 0;
  display: none;
  align-items: center;
  justify-content: center;
  font-size: 120px;
  font-weight: 800;
  color: #facc15;
  background: rgba(0, 0, 0, 0.65); 
  backdrop-filter: blur(6px);    
  z-index: 9998;
}
</style>
</head>

<body>
<div class="wrap">

<!-- SOLAR -->
<div class="card">
  <h1>T·∫øt D∆∞∆°ng <span class="small">(1/1)</span></h1>
  <div class="big" id="solar-count">--</div>
  <div class="units">
    <div class="unit"><div class="n" id="s-days">--</div><div class="small">Ng√†y</div></div>
    <div class="unit"><div class="n" id="s-hours">--</div><div class="small">Gi·ªù</div></div>
    <div class="unit"><div class="n" id="s-mins">--</div><div class="small">Ph√∫t</div></div>
    <div class="unit"><div class="n" id="s-secs">--</div><div class="small">Gi√¢y</div></div>
  </div>
</div>

<!-- LUNAR -->
<div class="card">
  <h1 id="lunar-title">T·∫øt √Çm <span class="small" id="lunar-label"></span></h1>
  <div class="big" id="lunar-count">--</div>
  <div class="units">
    <div class="unit"><div class="n" id="l-days">--</div><div class="small">Ng√†y</div></div>
    <div class="unit"><div class="n" id="l-hours">--</div><div class="small">Gi·ªù</div></div>
    <div class="unit"><div class="n" id="l-mins">--</div><div class="small">Ph√∫t</div></div>
    <div class="unit"><div class="n" id="l-secs">--</div><div class="small">Gi√¢y</div></div>
  </div>
</div>

<!-- CUSTOM -->
<div class="card">
  <h1 id="custom-title">‚è≥ S·ª± ki·ªán c·ªßa b·∫°n</h1>
  <div class="big" id="custom-count">--</div>
  <div class="units">
    <div class="unit"><div class="n" id="c-days">--</div><div class="small">Ng√†y</div></div>
    <div class="unit"><div class="n" id="c-hours">--</div><div class="small">Gi·ªù</div></div>
    <div class="unit"><div class="n" id="c-mins">--</div><div class="small">Ph√∫t</div></div>
    <div class="unit"><div class="n" id="c-secs">--</div><div class="small">Gi√¢y</div></div>
  </div>
</div>

<div class="controls">
  <!-- LUNAR CONTROL -->
  <div class="input-row">
    <input type="datetime-local" id="lunar-input">
    <button id="set-lunar">C·∫≠p nh·∫≠t ng√†y v·ªÅ T·∫øt √Çm</button>
    <button id="reset-lunar">Reset m·∫∑c ƒë·ªãnh</button>
  </div>

  <!-- CUSTOM -->
  <div class="input-row">
    <input type="text" id="custom-name" placeholder="T√™n s·ª± ki·ªán">
    <input type="datetime-local" id="custom-datetime">
    <button id="set-custom">T·∫°o</button>
    <button id="reset-custom">X√≥a</button>
  </div>
</div>

<footer>¬© L√™ Th·ªã Ng·ªçc Dung</footer>
</div>

<div id="toast" class="toast"></div>

<div id="countdown">
  <span id="count-num">3</span>
</div>

<div id="celebrate" style="
  position:fixed;
  inset:0;
  display:none;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  background:rgba(0,0,0,.85);
  z-index:9999;
  color:#facc15;
  font-size:48px;
  font-weight:800;
  text-align:center;">
  <div id="celebrate-title"></div>
  <div id="celebrate-sub" style="font-size:18px;margin-top:12px;color:#fff"></div>
</div>
<canvas id="fireworks"></canvas>

<script>
  let isCountingDown = false;
  let isCelebrating = false;

const LUNAR_NEW_YEAR={
2024:"2024-02-10",2025:"2025-01-29",2026:"2026-02-17",
2027:"2027-02-06",2028:"2028-01-26",2029:"2029-02-13",
2030:"2030-02-03",2031:"2031-01-23",2032:"2032-02-11",
2033:"2033-01-31",2034:"2034-02-19",2035:"2035-02-08",
2036:"2036-01-28",2037:"2037-02-15",2038:"2038-02-04",
2039:"2039-01-24",2040:"2040-02-12"
};

const el=id=>document.getElementById(id);
const toast=m=>{
  const t=el("toast");t.textContent=m;
  t.classList.add("show");
  setTimeout(()=>t.classList.remove("show"),2000);
};
const lunarInput = el("lunar-input");

function formatDateTimeLocal(date) {
  const pad = n => String(n).padStart(2, "0");
  return (
    date.getFullYear() + "-" +
    pad(date.getMonth() + 1) + "-" +
    pad(date.getDate()) + "T" +
    pad(date.getHours()) + ":" +
    pad(date.getMinutes())
  );
}

let lunarMode=localStorage.getItem("lunar-mode")||"auto";
let lunarTarget;
let lunarPhase = "lunar"; 
let forcedSeconds = null;

function getNextLunar(){
  const now=new Date();
  for(let y=now.getFullYear();y<=2040;y++){
    const d=LUNAR_NEW_YEAR[y];
    if(d&&new Date(d)>now) return new Date(d);
  }
}

function setLunarLabel(){
  el("lunar-title").firstChild.nodeValue =
    lunarPhase === "custom" ? "Ng√†y v·ªÅ T·∫øt √Çm " : "T·∫øt √Çm ";

  el("lunar-label").textContent =
    lunarTarget.toLocaleDateString();
}

if(lunarMode==="custom"){
  lunarTarget=new Date(localStorage.getItem("lunar-custom"));
}else{
  lunarTarget=getNextLunar();
}
lunarInput.max = formatDateTimeLocal(lunarTarget);
setLunarLabel();

function update(t,p){
  const n=new Date();
  let dff=Math.max(0,t-n);
  const d=Math.floor(dff/86400000);dff%=86400000;
  const h=Math.floor(dff/3600000);dff%=3600000;
  const m=Math.floor(dff/60000);dff%=60000;
  const s=Math.floor(dff/1000);
  el(p+"-days").textContent=d;
  el(p+"-hours").textContent=String(h).padStart(2,"0");
  el(p+"-mins").textContent=String(m).padStart(2,"0");
  el(p+"-secs").textContent=String(s).padStart(2,"0");
  el({s:"solar-count",l:"lunar-count",c:"custom-count"}[p])
    .textContent=`${d} ng√†y ${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;
}

/* LUNAR BUTTONS */
el("set-lunar").onclick = () => {
  const v = el("lunar-input").value;
  if (!v) return toast("Ch·ªçn ng√†y ƒëi üò§");

  lunarTarget = new Date(v);
  lunarMode = "custom";
  lunarPhase = "custom";

  localStorage.setItem("lunar-mode","custom");
  localStorage.setItem("lunar-custom",v);

  setLunarLabel();
  toast("ƒê√£ c·∫≠p nh·∫≠t ng√†y v·ªÅ T·∫øt √Çm üéâ");
};

el("reset-lunar").onclick = () => {
  lunarMode = "auto";
  lunarPhase = "lunar";

  localStorage.setItem("lunar-mode","auto");
  localStorage.removeItem("lunar-custom");

  lunarTarget = getNextLunar();
  setLunarLabel();

  toast("ƒê√£ reset v·ªÅ T·∫øt √Çm ‚úîÔ∏è");
};

setInterval(() => {
  const now = new Date();

  /* ===== T·∫æT D∆Ø∆†NG ===== */
  const solarTarget = new Date(now.getFullYear()+1,0,1);
  const solarDiff = solarTarget - now;

  if (!isCountingDown && !isCelebrating) {
    update(solarTarget,"s");
  }

  if (solarDiff <= 3500 && solarDiff > 2500 && !isCountingDown && !isCelebrating) {
    startCountdown(() => celebrate("solar"));
  }

  /* ===== T·∫æT √ÇM ===== */
  const lunarDiff = lunarTarget - now;

  if (!isCountingDown && !isCelebrating) {
    update(lunarTarget,"l");
  }

  if (lunarDiff <= 3500 && lunarDiff > 2500 && !isCountingDown && !isCelebrating) {
    startCountdown(() => {
      celebrate("lunar");
      lunarTarget = getNextLunar();
      setLunarLabel();
    });
  }

  /* ===== CUSTOM EVENT (LU√îN CH·∫†Y) ===== */
  if (customTarget) {
    update(customTarget,"c");
  }

  lunarInput.max = formatDateTimeLocal(lunarTarget);
}, 1000);

/* CUSTOM */
let customTarget=null;
const saved=JSON.parse(localStorage.getItem("custom")||"null");
if(saved){
  customTarget=new Date(saved.date);
  el("custom-title").textContent="‚è≥ "+saved.name;
}
el("set-custom").onclick=()=>{
  const n=el("custom-name").value.trim();
  const d=el("custom-datetime").value;
  if(!n||!d) return toast("Nh·∫≠p ƒë·ªß üò§");
  customTarget=new Date(d);
  el("custom-title").textContent="‚è≥ "+n;
  localStorage.setItem("custom",JSON.stringify({name:n,date:d}));
  toast("ƒê√£ t·∫°o ‚ú®");
};
el("reset-custom").onclick=()=>{
  customTarget=null;localStorage.removeItem("custom");
  el("custom-title").textContent="‚è≥ S·ª± ki·ªán c·ªßa b·∫°n";
  ["c-days","c-hours","c-mins","c-secs"].forEach(i=>el(i).textContent="--");
  el("custom-count").textContent="--";
  toast("ƒê√£ x√≥a üóëÔ∏è");
};

function startCountdown(onDone) {
  if (isCountingDown) return;
  isCountingDown = true;

  const cd = el("countdown");
  const num = el("count-num");
  cd.style.display = "flex";

  let n = 3;
  num.textContent = n;

  const timer = setInterval(() => {
    n--;
    if (n === 0) {
      clearInterval(timer);
      cd.style.display = "none";
      isCountingDown = false;
      onDone();
    } else {
      num.textContent = n;
    }
  }, 1000);
}
function celebrate(type) {
  if (isCelebrating) return;
  isCelebrating = true;

  const overlay = el("celebrate");
  const title = el("celebrate-title");
  const sub = el("celebrate-sub");

  if (type === "solar") {
    title.textContent = "üéâ HAPPY NEW YEAR üéâ";
    sub.textContent = "Wishing you joy, success and happiness";
  } else {
    title.textContent = "üéä CH√öC M·ª™NG NƒÇM M·ªöI üéä";
    sub.textContent = "An khang ‚Äì Th·ªãnh v∆∞·ª£ng ‚Äì V·∫°n s·ª± nh∆∞ √Ω";
  }

  overlay.style.display = "flex";
  startFireworks();

  toast(type === "solar"
    ? "üéâ Happy New Year!"
    : "üéä Ch√∫c m·ª´ng nƒÉm m·ªõi!");

  setTimeout(() => {
    overlay.style.display = "none";
    stopFireworks();
    isCelebrating = false;
  }, 5000);
}

const canvas = document.getElementById("fireworks");
const ctx = canvas.getContext("2d");

let fireworks = [];
let fireworksRunning = false;

function resizeCanvas() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resizeCanvas);
resizeCanvas();

class Particle {
  constructor(x, y, color) {
    this.x = x;
    this.y = y;
    this.radius = Math.random() * 2 + 1;
    this.color = color;
    this.speedX = (Math.random() - 0.5) * 6;
    this.speedY = (Math.random() - 0.5) * 6;
    this.life = 60;
  }
  update() {
    this.x += this.speedX;
    this.y += this.speedY;
    this.life--;
  }
  draw() {
    ctx.beginPath();
    ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
    ctx.fillStyle = this.color;
    ctx.fill();
  }
}

function createFirework() {
  const x = Math.random() * canvas.width;
  const y = Math.random() * canvas.height * 0.6;
  const colors = ["#facc15", "#fb7185", "#60a5fa", "#34d399", "#f472b6"];

  for (let i = 0; i < 60; i++) {
    fireworks.push(new Particle(x, y, colors[Math.floor(Math.random() * colors.length)]));
  }
}

function animateFireworks() {
  if (!fireworksRunning) return;

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  fireworks = fireworks.filter(p => p.life > 0);
  fireworks.forEach(p => {
    p.update();
    p.draw();
  });

  requestAnimationFrame(animateFireworks);
}

function startFireworks() {
  fireworksRunning = true;
  fireworks = [];
  animateFireworks();

  const interval = setInterval(() => {
    if (!fireworksRunning) {
      clearInterval(interval);
      return;
    }
    createFirework();
  }, 600);
}

function stopFireworks() {
  fireworksRunning = false;
  ctx.clearRect(0, 0, canvas.width, canvas.height);
}
</script>
</body>
</html>

